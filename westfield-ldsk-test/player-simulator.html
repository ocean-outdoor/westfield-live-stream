<html>

<head>
    <title>LDSK Player Simulator - Westfield Live Stream</title>
    <style>
        body {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            margin: 0;
            background-color: #000;
        }

        iframe {
            width: 640px;
            height: 1280px;
            border: 0;
        }
    </style>

    <script>
        window.addEventListener("load", function () {
            console.log('Player simulator loaded');

            // Listen for messages from the creative
            if (window.addEventListener) {
                window.addEventListener("message", receiveMessage);
            } else {
                window.attachEvent("onmessage", receiveMessage);
            }
        });

        function receiveMessage(event) {
            console.log('Received message from creative:', event.data);

            if (event.data && event.data.type === 'ldsk') {
                console.log(`Event type: ${event.data.eventType}`);

                if (event.data.eventType === 'CREATIVE_READY') {
                    console.log('Creative is ready!');
                }
            }
        }

        // Send message to iframe via postMessage
        function sendPostMessage(message, iframeId) {
            const iframe = document.getElementById(iframeId);
            if (iframe && iframe.contentWindow) {
                iframe.contentWindow.postMessage(message, "*");
                console.log('Sent to creative:', message);
            } else {
                console.error('Failed to send message - iframe not found');
            }
        }

        function initFunc() {
            console.log('Initializing creative...');

            // Send PLAYER_CONFIGURATION event
            sendPostMessage(
                {
                    type: "ldsk",
                    eventType: "PLAYER_CONFIGURATION",
                    payload: {
                        inventory: {
                            attributes: {
                                screenId: "westfield-screen-001",
                                location: "Westfield Shopping Centre",
                                city: "London",
                                width: 640,
                                height: 1280
                            }
                        }
                    }
                },
                "westfield-iframe"
            );

            // Send PLAY event after 5 seconds
            setTimeout(() => {
                sendPostMessage(
                    {
                        type: "ldsk",
                        eventType: "PLAY",
                        payload: {}
                    },
                    "westfield-iframe"
                );
            }, 5000);
        }
    </script>
</head>

<body>
    <iframe id="westfield-iframe" src="index.html" onload="initFunc()"></iframe>
</body>

</html>
